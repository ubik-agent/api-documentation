---
title: "Guide : Obtenir des Résultats en Temps Réel avec SSE"
description: "Apprenez à streamer des événements en temps réel depuis une exécution d'outil en utilisant les Server-Sent Events (SSE)."
---

L'interrogation des résultats est efficace, mais pour une expérience plus réactive et en temps réel, vous pouvez streamer les événements directement depuis un outil en cours d'exécution. Ce guide montre comment se connecter au flux d'événements d'un outil en utilisant les Server-Sent Events (SSE).

Ce guide suppose que vous avez déjà lancé une exécution d'outil comme indiqué dans le guide [Exécuter Votre Premier Outil](/fr/guides/executing-tools).

<Steps>

<Step title="Exécuter un Outil et Obtenir l'URL de Streaming">
  Tout d'abord, exécutez un outil comme vous le feriez normalement. La réponse initiale `202 Accepted` contiendra une `stream_url`. C'est l'endpoint que nous utiliserons pour recevoir les événements en direct.

  ```json Réponse
  {
    "execution_id": "exec_123456789",
    "status": "pending",
    "tool_id": "d1e2f3a4-b5c6-7890-1234-567890abcdef",
    "details_url": "https://app.ubik-agent.com/api/v1/tool-executions/exec_123456789",
    "stream_url": "https://app.ubik-agent.com/api/v1/tool-executions/exec_123456789/stream"
  }
  ```
  
  Copiez la `stream_url` pour l'étape suivante.
</Step>

<Step title="Se Connecter au Flux d'Événements">
  Maintenant, vous pouvez vous connecter à la `stream_url` en utilisant n'importe quel client compatible SSE. La connexion restera ouverte, et le serveur enverra les événements au fur et à mesure qu'ils se produisent.

  <CodeGroup title="GET /tool-executions/{execution_id}/stream">
  ```bash cURL
  # Utilisez l'option -N pour désactiver la mise en mémoire tampon
  curl -X GET "https://app.ubik-agent.com/api/v1/tool-executions/exec_123456789/stream" \
       -H "X-API-KEY: VOTRE_CLE_API" \
       -N
  ```
  ```python Python
  import requests
  import json

  api_key = "VOTRE_CLE_API"
  stream_url = "https://app.ubik-agent.com/api/v1/tool-executions/exec_123456789/stream"
  
  headers = {"X-API-KEY": api_key, "Accept": "text/event-stream"}

  with requests.get(stream_url, headers=headers, stream=True) as response:
      if response.status_code == 200:
          for line in response.iter_lines():
              if line:
                  decoded_line = line.decode('utf-8')
                  if decoded_line.startswith('data:'):
                      try:
                          # Extraire la partie JSON du message
                          json_data = decoded_line[5:].strip()
                          event_payload = json.loads(json_data)
                          print("Événement reçu:", event_payload)
                          
                          # Vérifier la fin du flux
                          if event_payload.get("event_type") == "final_result":
                              print("Flux terminé.")
                              break
                      except json.JSONDecodeError:
                          print(f"Impossible de décoder la ligne: {decoded_line}")
      else:
          print(f"Erreur de connexion au flux: {response.status_code}", response.text)
  ```
  ```javascript JavaScript
  const apiKey = "VOTRE_CLE_API";
  const streamUrl = "https://app.ubik-agent.com/api/v1/tool-executions/exec_123456789/stream";

  const eventSource = new EventSource(`${streamUrl}?api_key=${apiKey}`);

  eventSource.onopen = () => {
    console.log("Connexion au flux d'événements ouverte.");
  };

  eventSource.onmessage = (event) => {
    const eventPayload = JSON.parse(event.data);
    console.log("Événement reçu:", eventPayload);

    if (eventPayload.event_type === "final_result") {
      console.log("Flux terminé. Fermeture de la connexion.");
      eventSource.close();
    }
  };

  eventSource.onerror = (error) => {
    console.error("EventSource a échoué:", error);
    eventSource.close();
  };
  ```
  </CodeGroup>
  
  <Note>
  Dans l'exemple JavaScript `EventSource`, nous passons la clé API comme paramètre de requête. Notre serveur est configuré pour accepter la clé API soit via l'en-tête `X-API-KEY`, soit via un paramètre de requête nommé `api_key` pour les connexions SSE, car `EventSource` ne prend pas en charge les en-têtes personnalisés.
  </Note>

</Step>

<Step title="Comprendre les Événements">
  Au fur et à mesure que l'outil s'exécute, vous recevrez une série d'objets JSON. Chaque objet contient un `event_type` et une charge utile `data`. Voici les principaux types d'événements :

  - **`tool_update`** : Une mise à jour générale de la progression. La charge utile `data` contient souvent des champs `phase` et `message` pour décrire l'état actuel.
  - **`tool_partial_update`** : Un fragment de contenu en streaming. La charge utile `data` contient un champ `content` avec le morceau de texte.
  - **`final_result`** : L'événement final d'une exécution réussie, contenant les `outputs` complets dans la charge utile `data`.
  - **`tool_input_required`** : Envoyé lorsqu'un outil interactif a besoin d'une entrée de l'utilisateur.
  - **`error`** : Indique qu'une erreur est survenue pendant l'exécution.

  ```json Exemple de Flux d'Événements
  data: {"event_type": "tool_update", "data": {"phase": "retrieval", "message": "Récupération des documents pertinents..."}}

  data: {"event_type": "tool_update", "data": {"phase": "generation", "message": "Génération de la réponse..."}}

  data: {"event_type": "tool_partial_update", "data": {"content": "Les résultats financiers montrent..."}}

  data: {"event_type": "tool_partial_update", "data": {"content": " une augmentation significative du chiffre d'affaires."}}

  data: {"event_type": "final_result", "data": {"outputs": {"response": "Les résultats financiers montrent une augmentation significative du chiffre d'affaires."}}}
  ```
</Step>

</Steps>

En utilisant les Server-Sent Events, vous pouvez créer des applications hautement interactives et réactives qui réagissent en temps réel aux processus de longue durée.
